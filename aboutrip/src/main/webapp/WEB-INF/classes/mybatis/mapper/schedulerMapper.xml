<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="scheduler">
	<insert id="insertScheduler" parameterType="com.aboutrip.app.scheduler.Scheduler">
		INSERT INTO	scheduler(num, user_num, subject, created, color, check_in, check_out, memo) VALUES(scheduler_seq.NEXTVAL,#{user_num}, #{subject}, SYSDATE, #{color},#{check_in, jdbcType=VARCHAR},#{check_out, jdbcType=VARCHAR}, #{memo, jdbcType=VARCHAR})
	</insert>
	<select id="listMonth" parameterType="map" resultType="com.aboutrip.app.scheduler.Scheduler">
		select num, user_num, subject, TO_CHAR(created,'YYYY-MM-DD') created, color, 
		TO_CHAR(check_in,'YYYY-MM-DD')check_in, TO_CHAR(check_out,'YYYY-MM-DD')check_out, memo FROM scheduler
		WHERE	user_num = #{user_num}
		ORDER BY check_in ASC, num DESC
	</select>
	<update id="updateScheduler" parameterType="map">
		UPDATE scheduler SET
			subject=#{subject}, color=#{color}, check_in=#{check_in, jdbcType=VARCHAR}, 
			check_out=#{check_out, jdbcType=VARCHAR},
			memo=#{memo, jdbcType=VARCHAR}
		WHERE num=#{num} AND user_num=#{user_num}
	</update>
	<delete id="deleteScheduler" parameterType="map">
		DELETE FROM scheduler WHERE num=#{num} AND user_num=#{user_num}
	</delete>
	
	<select id="scheduler_seq" resultType="Integer">
       SELECT scheduler_seq.NEXTVAL FROM dual 
    </select>
    
    <insert id="insertMate" parameterType="com.aboutrip.app.scheduler.Mate">
    	INSERT INTO mate(num, user_num, subject, content, ctgNum, created, people_num, current_num, start_date, end_date,answer)
    	VALUES(mate_seq.NEXTVAL, #{user_num}, #{subject}, #{content}, #{ctgNum}, SYSDATE, #{people_num}, 0,
    	#{start_date, jdbcType=VARCHAR}, #{end_date, jdbcType=VARCHAR},0)
    </insert>
    
    <select id="mateCount" resultType="Integer">
    	SELECT NVL(COUNT(*),0) FROM mate
    </select>
    
    <insert id="insertMateReply" parameterType="com.aboutrip.app.scheduler.Mate">
    	INSERT INTO mate_reply(reply_num, user_num, mate_num, content, created, reply) VALUES (mate_reply_seq.NEXTVAL, #{user_num}, #{num}, #{content}, SYSDATE)
    </insert>
    
    <select id="listMate" parameterType="map" resultType="com.aboutrip.app.scheduler.Mate">
    	SELECT num, m.user_num, subject, content, ctgNum, TO_CHAR(created, 'YYYY-MM-DD')created, people_num, current_num, TO_CHAR(start_date,'YYYY-MM-DD')start_date, TO_CHAR(end_date,'YYYY-MM-DD')end_date,
    	nickName FROM mate m
    	JOIN member1 m1 ON m.user_num = m1.userNum
    	ORDER BY num DESC
    	OFFSET #{offset} ROW FETCH FIRST #{rows} ROWS ONLY
    </select>
</mapper>